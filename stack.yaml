AWSTemplateFormatVersion: "2010-09-09"
Transform: AWS::Serverless-2016-10-31
Description: Arine PDF Optimization, Validation, and Transmogrification (OVT) Service

Globals:
  Function:
    Timeout: 5
    Runtime: python3.13
    Tracing: Active
    Environment:
      Variables:
        POWERTOOLS_LOG_LEVEL: INFO
        # POWERTOOLS_LOGGER_SAMPLE_RATE: 0.1
        POWERTOOLS_LOGGER_LOG_EVENT: true
        POWERTOOLS_SERVICE_NAME:
          Fn::Sub: ${AWS::StackName}_arine-pdf-ovt-service

Resources:
  ArinePdfOvtProgramsLayer:
    Type: AWS::Serverless::LayerVersion
    Properties:
      LayerName:
        Fn::Sub: ${AWS::StackName}_arine-pdf-ovt-programs
      Description: Arine PDF Optimization, Validation, and Transmogrification (OVT) Programs Layer
      ContentUri: ./build/programs.zip
      CompatibleRuntimes:
        - python3.13
      RetentionPolicy: Delete

  ArinePdfOvtRequirementsLayer:
    Type: AWS::Serverless::LayerVersion
    Properties:
      LayerName:
        Fn::Sub: ${AWS::StackName}_arine-pdf-ovt-requirements
      Description: Arine PDF Optimization, Validation, and Transmogrification (OVT) Requirements Layer
      ContentUri: ./build/requirements.zip
      CompatibleRuntimes:
        - python3.13
      RetentionPolicy: Delete

  ArinePdfOvtLayerHealthCheckFunction:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName:
        Fn::Sub: ${AWS::StackName}_arine-pdf-ovt-health-check
      Description: Health check for the Arine PDF Optimization, Validation, and Transmogrification (OVT) Service
      CodeUri: ./src
      Handler: arine_pdf_ovt.health_check.handlers.health_check_handler
      Architectures:
        - arm64
      Environment:
        Variables:
          POWERTOOLS_METRICS_NAMESPACE: health-check
      Layers:
        - Ref: ArinePdfOvtProgramsLayer
        - Ref: ArinePdfOvtRequirementsLayer

  ArinePdfOvtLayerS3DirectFunction:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName:
        Fn::Sub: ${AWS::StackName}_arine-pdf-ovt-s3-direct
      Description: S3 direct handler for the Arine PDF Optimization, Validation, and Transmogrification (OVT) Service
      CodeUri: ./src
      Handler: arine_pdf_ovt.s3_direct.handlers.s3_direct_handler
      Architectures:
        - arm64
      Environment:
        Variables:
          POWERTOOLS_METRICS_NAMESPACE: s3-direct
      Layers:
        - Ref: ArinePdfOvtProgramsLayer
        - Ref: ArinePdfOvtRequirementsLayer
